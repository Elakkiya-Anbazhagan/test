<div class="wrapper wrapper-content animated fadeInRight">
    <div class="panel" id="pnStaffAttedanceList">
        <div class="panel-header" *ngIf="isAttendanceMode">
            <h2><strong>Staff List</strong></h2>
            <div class="panel-tools" style="width:20%;">
                <form #frmStaffList="ngForm" (ngSubmit)="frmStaffList.valid && btnView_click()" novalidate autocomplete="off">
                    <div class="form-group col-md-12">
                        <div class="input-group">
                            <p-calendar dateFormat="dd-mm-yy" (onSelect)="btnView_click()" dataType="string" name="SalaryDate" [(ngModel)]="mlFoo.SalaryDate" #SalaryDate="ngModel" required></p-calendar>
                            <span class="input-group-btn">
                                <button type="submit" class="btn btn-primary btn-sm"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="panel-content" *ngIf="isAttendanceMode">
            <p-dataTable [value]="StaffAttendanceDetailsList" [responsive]="true" [rows]="15" [paginator]="true" [pageLinks]="6" selectionMode="single"
            [tableStyleClass]="'tbl-list-guru'" [rowsPerPageOptions]="[5,10,15,20,30,50,100,200]"  #dt>
                <p-headerColumnGroup>
                    <p-row>
                        <p-column [style]="{'width':'30px','text-align':'center'}" header="#" rowspan="2"></p-column>
                        <p-column header="StaffID" [style]="{'width':'55px'}" rowspan="2"></p-column>
                        <p-column header="Name" rowspan="2"></p-column>
                        <p-column header="WorkingDays" colspan="3" [style]="{'width':'210px'}"></p-column>
                        <p-column header="Present" colspan="2" [style]="{'width':'135px'}"></p-column>
                        <p-column header="Leave" colspan="2" [style]="{'width':'135px'}"></p-column>
                        <p-column header="Permission" colspan="2" [style]="{'width':'135px'}"></p-column>
                        <p-column header="Deduction" colspan="2" [style]="{'width':'135px'}"></p-column>
                        <p-column header="NA" rowspan="2" [style]="{'width':'55px','text-align':'center'}"></p-column>
                    </p-row>
                    <p-row>
                        <p-column header="Payable" colspan="1" ></p-column>
                        <p-column header="UnPayable" colspan="1" ></p-column>
                        <p-column header="SpcPay" colspan="1" ></p-column>
                        <p-column header="Payable" colspan="1" ></p-column>
                        <p-column header="UnPayable" colspan="1" ></p-column>
                        <p-column header="Deduct" colspan="1" ></p-column>
                        <p-column header="UnDeduct" colspan="1" ></p-column>
                        <p-column header="Deduct" colspan="1" ></p-column>
                        <p-column header="UnDeduct" colspan="1" ></p-column>
                        <p-column header="Leave" colspan="1" ></p-column>
                        <p-column header="Permission" colspan="1" ></p-column>
                    </p-row>
                </p-headerColumnGroup>
                <p-column>
                    <ng-template let-rowIndex="rowIndex" pTemplate="body">
                        <div style="text-align:right !important">{{rowIndex+1}}</div>
                    </ng-template>
                </p-column>
                <p-column field="StaffID" [filter]="true" filterMatchMode="contains"></p-column>
                <p-column field="StaffName" [filter]="true" filterMatchMode="contains"></p-column>
                <p-column field="PWD" [style]="{'text-align':'center'}"></p-column>
                <p-column field="UPWD" [style]="{'text-align':'center'}"></p-column>
                <p-column field="SPWD" [style]="{'text-align':'center'}"></p-column>
                <p-column field="PR" [style]="{'text-align':'center'}"></p-column>
                <p-column field="SUPWD" [style]="{'text-align':'center'}"></p-column>
                <p-column field="AB" [style]="{'text-align':'center'}"></p-column>
                <p-column field="SUPWDD" [style]="{'text-align':'center'}"></p-column>
                <p-column field="PP" [style]="{'text-align':'center'}"></p-column>
                <p-column field="UPP" [style]="{'text-align':'center'}"></p-column>
                <p-column field="LeaveDeduct">
                    <ng-template let-data="rowData" pTemplate type="body">
                        <div style="text-align:right !important"> {{data.LeaveDeduct | number:'1.2-2'}}
                        </div>
                    </ng-template>
                </p-column>
                <p-column field="PermissionDeduct">
                    <ng-template let-data="rowData" pTemplate type="body">
                        <div style="text-align:right !important"> {{data.PermissionDeduct | number:'1.2-2'}}
                        </div>
                    </ng-template>
                </p-column>
                <p-column field="NA" [style]="{'text-align':'center'}"></p-column>
            </p-dataTable>
        </div>
        <div class="panel-content" *ngIf="isSalaryCalMode">
            <div class="row">
                <div class="table-responsive" style="width:1009.5px;">
                    <p-dataTable [value]="StaffAttendanceDetailsList" [responsive]="true" [rows]="10" frozenWidth="205px" unfrozenWidth="600px" [style]="{'margin-top':'30px'}" [paginator]="true" [pageLinks]="6" selectionMode="single"
                    [tableStyleClass]="'tbl-list-guru'" [rowsPerPageOptions]="[5,10,15,20,30,50,100,200]">
                        <p-headerColumnGroup>
                            <p-row>
                                <p-column [style]="{'width':'30px','text-align':'center'}" header="#" rowspan="2"></p-column>
                                <p-column header="StaffID" [style]="{'width':'55px'}" rowspan="2"></p-column>
                                <p-column header="Name" rowspan="2" [style]="{'width':'120px'}"></p-column>
                                <p-column header="Account" rowspan="2" [style]="{'width':'120px'}"></p-column>
                                <p-column header="PayMode" rowspan="2" [style]="{'width':'120px'}"></p-column>
                                <p-column header="Salary" rowspan="2" [style]="{'width':'80px'}"></p-column>
                                <p-column header="Payable" colspan="6" [style]="{'width':'480px'}"></p-column>
                                <p-column header="Deduction" colspan="5" [style]="{'width':'360px'}"></p-column>
                                <p-column header="SpcSalary" rowspan="2" [style]="{'width':'90px'}"></p-column>
                                <p-column header="GrossSalary" rowspan="2" [style]="{'width':'120px'}"></p-column>
                                <p-column header="NetSalary" rowspan="2" [style]="{'width':'120px'}"></p-column>
                            </p-row>
                            <p-row>
                                <p-column header="Basic" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="Grade" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="DA" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="CA" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="HRA" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="MA" colspan="1" [style]="{'width':'80px'}"></p-column>
                                <p-column header="PF" colspan="1"></p-column>
                                <p-column header="TDS" colspan="1"></p-column>
                                <p-column header="Leave" colspan="1"></p-column>
                                <p-column header="Permis." colspan="1"></p-column>
                                <p-column header="Loan" colspan="1"></p-column>
                            </p-row>
                        </p-headerColumnGroup>
                        <p-column>
                            <ng-template let-rowIndex="rowIndex" pTemplate="body">
                                <div style="text-align:right !important">{{rowIndex+1}}</div>
                            </ng-template>
                        </p-column>
                        <p-column field="StaffID" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column field="StaffName" [filter]="true" filterMatchMode="contains"></p-column>
                        <p-column [style]="{'width':'120px','text-align':'center'}">
                            <ng-template let-data="rowData" let-rowIndex="rowIndex" pTemplate="body">
                                <p-dropdown [options]="lstStu_Account" [(ngModel)]="data.AccountSysID"></p-dropdown>
                            </ng-template>
                        </p-column>
                        <p-column [style]="{'width':'120px','text-align':'center'}">
                            <ng-template let-data="rowData" let-rowIndex="rowIndex" pTemplate="body">
                                <p-dropdown [options]="lstStu_Paymode" [(ngModel)]="data.PayModeSysID"></p-dropdown>
                            </ng-template>
                        </p-column>
                        <p-column field="ActualSalary">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.ActualSalary | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="BasicPay">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.BasicPay | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="GradePay">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.GradePay | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="DA">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.DA | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="CA">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.CA | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="HRA">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.HRA | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="MA">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.MA | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="PF" [style]="{ 'width': '40px'}">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.PF | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="TDS" [style]="{ 'width': '40px'}">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.TDS | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="LeaveDeduct" [style]="{ 'width': '120px'}">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.LeaveDeduct | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="PermissionDeduct" [style]="{ 'width': '90px'}">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.PermissionDeduct | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="LoanAmount" header="Stu. Cnt." [style]="{ 'width': '70px'}">
                            <ng-template let-data="rowData" pTemplate="body">
                                <div class="" style="text-align:right !important;">
                                    <a (click)="btnLoanList(data.LoanDetails);">{{CalculateLoanAmount(data.LoanDetails) | number:'1.2-2'}}</a>
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="ExtraSalary">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.ExtraSalary | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="GrossSalary">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.GrossSalary | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-column field="NetSalary">
                            <ng-template let-data="rowData" pTemplate type="body">
                                <div style="text-align:right !important"> {{data.NetSalary | number:'1.2-2'}}
                                </div>
                            </ng-template>
                        </p-column>
                        <p-footerColumnGroup>
                            <p-row>
                                <p-column colspan="3">
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700;">Totals:</div>
                                    </ng-template>
                                </p-column>
                                <p-column></p-column>
                                <p-column></p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateActualSalary()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateBasicPay()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateGradePay()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateDA()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateCA()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateHRA()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateMA()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculatePF()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateTDS()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateLeaveDeduct()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculatePermissionDeduct()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateLoanAmount()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateExtraSalary()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateGrossSalary()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                                <p-column>
                                    <ng-template let-data pTemplate="footer">
                                        <div class="" style="text-align:right !important; font-weight: 700; ">
                                            {{(calculateNetSalary()) | currency:'INR':true:'1.2-2'}}
                                        </div>
                                    </ng-template>
                                </p-column>
                            </p-row>
                        </p-footerColumnGroup>
                    </p-dataTable>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <div class="pull-right">
                        <label *ngIf="isAttendanceMode && SalaryCount !== 0" class="btn btn-sm btn-success">Staff Salary has been generated</label>
                        <button type="button" class="btn btn-sm btn-success" *ngIf="isAttendanceMode && SalaryApprovalCount !== 0 && SalaryCount === 0" (click)="btnStaffSalaryApproval_click()">Approve Staff Salary</button>
                        <button type="button" class="btn btn-sm btn-primary" *ngIf="isAttendanceMode && SalaryCount === 0" (click)="btnStaffSalaryCalculation_click()">Calculate Salary</button>
                        <button type="button" class="btn btn-sm btn-primary" *ngIf="isSalaryCalMode && SalaryCount === 0" (click)="btnStaffSalaryGeneration_click()">Generate Salary</button>
                        <button type="button" class="btn btn-sm btn-danger" (click)="btnCancel_click()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<modal #mdLoanList [keyboard]="false" [backdrop]="'static'" cssClass="modal-md">
    <modal-header>
        <h1 class="modal-title"> <strong>Loan Installment List</strong></h1>
    </modal-header>
    <modal-body class="error-style">
        <p-dataTable [value]="dtLoanList" scrollable="true" scrollHeight="350px">
            <p-column header="#" [style]="{ 'width': '20px', 'text-align': 'center'}">
                <ng-template let-rowIndex="rowIndex" pTemplate="body">
                    <div style="text-align:right !important">{{rowIndex + 1}}</div>
                </ng-template>
            </p-column>
            <p-column field="Installment" header="Installment"></p-column>
            <p-column field="InstallmentDate" header="Date"></p-column>
            <p-column field="Amount" header="Amount"></p-column>
            <p-column field="TypeID" header="TypeID"></p-column>
            <p-column field="IsSelected" header="Option" [style]="{'width' : '70px', 'text-align': 'center'}">
                <ng-template let-data="rowData" let-rowIndex="rowIndex" pTemplate="body">
                    <p-checkbox [(ngModel)]="data.isSelected" [binary]="true" [value]="data.isSelected"></p-checkbox>
                </ng-template>
            </p-column>
        </p-dataTable>
    </modal-body>
    <modal-footer>
        <button type="button" name="btnCloseEntry" class="btn btn-danger" (click)="btnLoanModelClose_Click();">Close</button>
    </modal-footer>
</modal>